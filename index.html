<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>Sparnatural + AI</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,700|Open+Sans:300,300i,400,400i,700,700i"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link
      href="assets/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />

    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet" />

    <!-- Sparnatural-specific -->

    <!-- Vis.js for timeline -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css"
    />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="assets/fa6/css/all.min.css" />

    <!-- YASGUI CSS -->
    <link
      href="https://unpkg.com/@triply/yasgui/build/yasgui.min.css"
      rel="stylesheet"
      type="text/css"
    />

    <!-- datepicker -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@chenfengyuan/datepicker@1.0.9/dist/datepicker.min.css"
    />

    <!-- Sparnatural CSS -->
    <link href="./sparnatural.css" rel="stylesheet" />
    <!-- Timeline CSS -->
    <link rel="stylesheet" href="assets/css/timeline.css" />

    <link href="sparnatural-history.css" rel="stylesheet" />

    <link href="sparnatural-text-query.css" rel="stylesheet" />

    <style>
      /* Making the container modal flexible with the height of .sticky-query-bar */
      .yasr {
        padding-bottom: calc(var(--sticky-bar-height, 100px) + 20px);
      }
      .modal {
        z-index: 1050 !important; /* valeur doit etre supérieure à celle de l'overlay */
      }
      .modal-backdrop {
        z-index: 1040 !important; /* L'overlay doit avoir un z-index inferieur*/
      }

      .yasqe .CodeMirror {
        font-size: 0.8em;
      }

      #sparnatural-section {
        padding-top: 40px;
        height: auto;
        overflow: visible;
      }

      #yasqe {
        display: none;
      }

      #contact {
        margin-top: 40px;
        padding: 0px;
        padding-top: 20px;
      }

      .sticky-query-bar {
        display: flex;
        align-items: center;
        padding: 0 0 0 20px;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: auto;
        max-height: 250px;
        background: #fff;
        z-index: 999;
        box-shadow: 0px 0px 12px rgba(0, 0, 0, 0.1);
        overflow: visible;
      }
      .sticky-query-bar .contact-about {
        flex: 0 0 auto;
        width: 220px;
      }

      .sticky-query-bar sparnatural-text-query {
        flex: 1 1 auto;
        margin: 0 20px 0 0;
        min-width: 150px;
        max-width: calc(100% - 450px);
      }
    </style>

    <!-- /Sparnatural-specific -->
  </head>

  <body>
    <main>
      <!-- ======= Header ======= -->
      <header id="header" class="d-flex align-items-center">
        <div
          class="container d-flex justify-content-between align-items-center"
        >
          <div id="logo">
            <h1><a href="index.html" data-i18n="page.title"></a></h1>
          </div>

          <nav id="navbar" class="navbar">
            <ul>
              <!--for doc page readme file -->
              <li>
                <a class="nav-link" href="./doc-page.html"
                  ><i style="font-size: 25px" class="fa-thin fa-book"></i
                  >&nbsp;<span data-i18n="menu.docs">Documentation</span></a
                >
              </li>
              <li class="dropdown">
                <a href="#"
                  ><i
                    style="font-size: 25px"
                    class="fa-thin fa-globe-africa"
                  ></i
                  >&nbsp;<span>Lang.</span> <i class="bi bi-chevron-down"></i
                ></a>
                <ul style="width: 80%">
                  <li><a href="?lang=fr">fr</a></li>
                  <li><a href="?lang=en">en</a></li>
                </ul>
              </li>
            </ul>
            <i class="bi bi-list mobile-nav-toggle"></i>
          </nav>
          <!-- .navbar -->
        </div>
      </header>
      <!-- End Header -->

      <!-- ======= Sparnatural Section ======= -->
      <section id="sparnatural-section">
        <div class="container">
          <div class="row">
            <div class="row">
              <span id="intro"><span data-i18n="[html]intro"></span></span>
            </div>

            <div class="row">&nbsp;</div>

            <div class="sticky-query-bar">
              <div class="contact-about">
                <a href="http://sparna.fr"
                  ><img src="assets/img/sparna.png" width="70%"
                /></a>
              </div>
              <sparnatural-text-query lang="en">
                <sparnatural-services
                  href="https://services.sparnatural.eu/api/v1/dbpedia-en/"
                ></sparnatural-services>
              </sparnatural-text-query>
              <!-- Museum in France displaying impressionist paintings -->
            </div>
          </div>
          <!-- This is where Sparnatural is inserted -->
          <div class="row">
            <spar-natural
              src="./sparnatural-config.ttl"
              endpoint="https://services.sparnatural.eu/api/v1/dbpedia-en/sparql"
              lang="en"
              defaultLang="en"
              distinct="true"
              limit="1000"
              debug="true"
            ></spar-natural>

            <input type="hidden" id="query-json" />
          </div>

          <!-- -->
          <div class="row">
            <div class="col-md-6">
              <span style="font-style: italic; font-size: 0.9em">
                <a href="#" id="sparql-toggle"
                  ><i id="sparql-toggle-icon" class="fad fa-eye fa-fw"></i
                  >&nbsp; <span data-i18n="actions.toggle"></span
                ></a>
                &nbsp;|&nbsp;
                <a href="#" id="share"
                  ><i id="share-icon" class="fad fa-share-square"></i>&nbsp;
                  <span data-i18n="actions.share"></span
                ></a>
                &nbsp;|&nbsp;
                <a href="#" id="export"
                  ><i id="export-icon" class="fad fa-file-export"></i>&nbsp;
                  <span data-i18n="actions.export"></span
                ></a>
                &nbsp;|&nbsp;
                <a href="#" id="import"
                  ><i id="import-icon" class="fad fa-file-import"></i>&nbsp;
                  <span data-i18n="actions.import"></span
                ></a>
              </span>
            </div>
            <div class="col-md-4">
              <form>
                <div class="form-group">
                  <select
                    class="form-control"
                    style="width: 100%; appearance: auto !important"
                    id="select-examples"
                  >
                    <option
                      value="none"
                      data-i18n="example.placeholder"
                      selected
                    ></option>
                    <option
                      value="example.1"
                      data-i18n="example.1.title"
                    ></option>
                    <option
                      value="example.2"
                      data-i18n="example.2.title"
                    ></option>
                    <option
                      value="example.3"
                      data-i18n="example.3.title"
                    ></option>
                  </select>
                </div>
              </form>
            </div>
            <div class="col-md-2">
              <sparnatural-history lang="en">
                <sparnatural-services
                  href="https://services.sparnatural.eu/api/v1/dbpedia-en/"
                >
                </sparnatural-services>
              </sparnatural-history>
              <button
                id="myCustomButton"
                class="btn btn-primary"
                style="width: 100%"
              >
                <i class="fad fa-history"></i>&nbsp;
                <span data-i18n="history"></span>
              </button>
            </div>
          </div>
        </div>
      </section>
      <!-- End Sparnatural Section -->

      <!-- ======= YASQE Section ======= -->
      <section id="yasqe-section">
        <div class="container">
          <div id="yasqe" style="display: none"></div>
        </div>
      </section>
      <!-- End YASQE Section -->

      <!-- ======= YASR Section ======= -->
      <section id="yasr-section" style="margin-top: 1em">
        <div class="container">
          <div id="yasr"></div>
        </div>
      </section>
      <!-- End YASR Section -->

      <!-- Modal -->
      <div
        class="modal fade"
        id="shareModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="shareModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5
                class="modal-title"
                id="shareModalLabel"
                data-i18n="share.modal.title"
              ></h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body" style="overflow: hidden">
              <a id="share-link" href="#"></a>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
                data-i18n="share.modal.close"
              ></button>
            </div>
          </div>
        </div>
      </div>

      <div
        class="modal fade"
        id="exportModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="jsonModelLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5
                class="modal-title"
                id="jsonModelLabel"
                data-i18n="export.modal.title"
              ></h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body" style="overflow: hidden">
              <textarea
                class="form-control"
                rows="20"
                id="export-json"
                style="width: 100%"
                readonly="readonly"
              ></textarea>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
                data-i18n="export.modal.close"
              ></button>
            </div>
          </div>
        </div>
      </div>

      <div
        class="modal fade"
        id="importModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="jsonModelLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5
                class="modal-title"
                id="jsonModelLabel"
                data-i18n="import.modal.title"
              ></h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body" style="overflow: hidden">
              <textarea
                class="form-control"
                rows="20"
                id="import-json"
                style="width: 100%"
              ></textarea>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-primary"
                id="importButton"
                data-i18n="import.modal.import"
              ></button>
            </div>
          </div>
        </div>
      </div>
    </main>
    <!-- End #main -->

    <a
      href="#"
      class="back-to-top d-flex align-items-center justify-content-center"
      ><i class="bi bi-chevron-up"></i
    ></a>

    <!-- Vendor JS Files -->
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Template Main JS File -->
    <script src="assets/js/demo.js"></script>
    <script src="sampleQueries.js"></script>

    <!-- Sparnatural-specific -->

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
      integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
      integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
      crossorigin="anonymous"
    ></script>

    <!-- datepicker -->
    <script src="https://cdn.jsdelivr.net/npm/@chenfengyuan/datepicker@1.0.9/dist/datepicker.min.js"></script>

    <!-- YASGUI stuff -->
    <script src="https://unpkg.com/@triply/yasgui/build/yasgui.min.js"></script>

    <!-- vis.js for the timeline -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <!--  defines timeline plugin -->
    <script src="assets/js/timeline.js"></script>
    <script src="assets/js/myTable.js"></script>

    <!-- Sparnatural Javascript -->
    <script type="text/javascript" src="./sparnatural.js"></script>
    <script
      type="text/javascript"
      src="./sparnatural-yasgui-plugins.js"
    ></script>

    <!-- /Sparnatural-specific -->

    <!-- i18n -->
    <script src="assets/vendor/jquery.i18n/jquery.i18n.js"></script>
    <script src="assets/vendor/jquery.i18n/jquery.i18n.messagestore.js"></script>
    <script src="assets/vendor/jquery.i18n/jquery.i18n.fallbacks.js"></script>
    <script src="assets/vendor/jquery.i18n/jquery.i18n.language.js"></script>
    <script src="assets/vendor/jquery.i18n/jquery.i18n.parser.js"></script>
    <script src="assets/vendor/jquery.i18n/jquery.i18n.emitter.js"></script>

    <!-- Json url (Compression) -->
    <script src="https://cdn.jsdelivr.net/gh/masotime/json-url@master/dist/browser/json-url.js"></script>

    <!-- Sheperd -->
    <script src="https://cdn.jsdelivr.net/npm/shepherd.js@8.3.1/dist/js/shepherd.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/shepherd.js@8.3.1/dist/css/shepherd.css"
    />
    <script src="tutorial.js"></script>

    <script src="sparnatural-bindings.js"></script>
    <script type="text/javascript" src="./sparnatural-history.js"></script>
    <script type="text/javascript" src="./sparnatural-services.js"></script>
    <script type="text/javascript" src="./sparnatural-text-query.js"></script>

    <script>
      $.urlParam = function (name) {
        var results = new RegExp("[\\?&amp;]" + name + "=([^&amp;#]*)").exec(
          window.location.href
        );
        if (results == null) {
          return null;
        }
        return results[1] || 0;
      };
      var lang = $.urlParam("lang") != null ? $.urlParam("lang") : "en";

      // set the locale
      $.i18n({ locale: lang });

      $.i18n().load({
        en: {
          "page.title": "Sparnatural + AI",
          "menu.home": "Sparnatural",
          "menu.lang": "Lang.",
          "menu.github": "Github",
          "menu.docs": "Documentation",
          "endpoint.querying": "Querying",
          "actions.toggle": "Toggle SPARQL editor",
          "actions.share": "Share",
          "actions.export": "Export query in JSON",
          "actions.import": "Import query in JSON",
          intro:
            "This demonstrator showcases <strong>how plain text queries can be interpreted as structured queries with an AI Agent, and shown in the Sparnatural query editor</strong>. Use the <a href='javascript:document.getElementById(\"naturalRequest\").focus();'>text area below</a> to type (or speak !) your request. It will then be showed in the query editor above.<br/><br/>Complete documentation of the prototype is available in the <a href='doc-page.html'>documentation page</a>.",
          "share.modal.title": "Direct query link",
          "share.modal.close": "Close",
          "export.modal.title": "Query as JSON",
          "export.modal.close": "Close",
          "import.modal.title": "Query as JSON",
          "import.modal.import": "Import",
          "example.placeholder": "Load example query...",
          "example.1.title": "Artworks displayed in Italian museums",
          "example.2.title": "Museums where Van Goghs artworks are displayed",
          "example.3.title":
            "19th Century French women artists, movements, artworks & museums",
          Results: "Results",
          send: "Send",
          Exemple: "Ex: Give me all artworks displayed in France",
          history: "History",
          OR: "- OR -",
        },
        fr: {
          "page.title": "Sparnatural + IA",
          "menu.home": "Sparnatural",
          "menu.lang": "Lang.",
          "menu.github": "Github",
          "menu.docs": "Documentation",
          "endpoint.querying": "Service SPARQL:",
          "actions.toggle": "Afficher/Masquer éditeur SPARQL",
          "actions.share": "Partager",
          "actions.export": "Exporter la requête en JSON",
          "actions.import": "Charger une requête en JSON",
          intro:
            "Ce démonstrateur illustre comment <strong>une requête plein texte est transformée en requête structurée avec un agent IA, puis est affichée dans l'éditeur de query Sparnatural</strong>. Utilisez la <a href='javascript:document.getElementById(\"naturalRequest\").focus();'>zone de texte en bas de page</a> pour saisir (ou dicter !) votre requête. Le résultat de la structuration sera affichée dans l'éditeur visuel au-dessus.<br/><br/>Une documentation complète du prototype est disponible dans la <a href='doc-page.html'>page de documentation</a>.",
          "share.modal.title": "Lien direct vers la requête",
          "share.modal.close": "Fermer",
          "export.modal.title": "Requête JSON",
          "export.modal.close": "Fermer",
          "import.modal.title": "Charger une requête en JSON",
          "import.modal.import": "Charger",
          "example.placeholder": "Charger une requête d'exemple...",
          "example.1.title": "Les œuvres exposées dans des musées italiens",
          "example.2.title":
            "Les musées qui exposent les oeuvres de Vincent Van Gogh",
          "example.3.title":
            "Les artistes françaises du XIXe, mouvements, œuvres & lieux d exposition",
          Results: "Résultats",
          send: "Envoyer",
          Exemple: "Ex : Donne-moi toutes les œuvres exposées en France",
          history: "Historique",
          OR: "- OU -",
        },
      });
      $("body").i18n();

      // Update navigation links to preserve language parameter
      function updateNavigationLinks() {
        const currentLang = lang;
        const langParam = currentLang !== "en" ? "?lang=" + currentLang : "";

        // Update Docs link
        const docsLink = document.querySelector('a[href="./doc-page.html"]');
        if (docsLink) {
          docsLink.href = "./doc-page.html" + langParam;
        }
      }

      // Call the function to update links
      updateNavigationLinks();

      // Appliquer les traductions aux attributs (comme placeholder)
      $("[data-i18n-placeholder]").each(function () {
        const key = $(this).data("i18n-placeholder");
        const translated = $.i18n(key);
        $(this).attr("placeholder", translated);
      });

      const sparnatural = document.querySelector("spar-natural");
      const historyComponent = document.querySelector("sparnatural-history");
      const sparnaturalTextQuery = document.querySelector(
        "sparnatural-text-query"
      );
      const services = sparnatural.querySelector("services");

      if (lang == "fr") {
        console.log(true);
        sparnatural.setAttribute("lang", "fr");
        historyComponent.setAttribute("lang", "fr");
        sparnaturalTextQuery.setAttribute("lang", "fr");
      }

      // prints the endpoint
      $("#endpoint").attr("href", sparnatural.getAttribute("endpoint"));
      $("#endpoint").html(sparnatural.getAttribute("endpoint"));

      let lastquery = null;
      // load ?query= param if present
      var UrlString = window.location.search;
      var urlParams = new URLSearchParams(UrlString);
      if (urlParams.has("query") === true) {
        var compressedJson = urlParams.get("query");
        var compressCodec = JsonUrl("lzma");
        compressCodec.decompress(compressedJson).then((json) => {
          console.log("Decompressed JSON to be loaded: ", json);
          sparnatural.loadQuery(JSON.parse(json));
        });
      }

      const yasqe = new Yasqe(document.getElementById("yasqe"), {
        requestConfig: {
          endpoint: $("#endpoint").text(),
          method: "GET",
          header: {},
        },
        copyEndpointOnNewTab: false,
      });

      Yasr.registerPlugin("TableX", SparnaturalYasguiPlugins.TableX);
      Yasr.registerPlugin("Grid", SparnaturalYasguiPlugins.GridPlugin);
      Yasr.registerPlugin("Stats", SparnaturalYasguiPlugins.StatsPlugin);
      Yasr.registerPlugin("Timeline", Timeline);
      Yasr.plugins.TableX.defaults.uriHrefAdapter = function (uri) {
        if (uri.startsWith("http://fr.dbpedia.org/resource/")) {
          return (
            "http://fr.wikipedia.org/wiki/" +
            uri.substring("http://fr.dbpedia.org/resource/".length)
          );
        } else {
          return uri;
        }
      };
      delete Yasr.plugins["table"];
      delete Yasr.plugins["response"];
      const yasr = new Yasr(document.getElementById("yasr"), {
        pluginOrder: ["TableX", "Grid", "Stats", "Timeline"],
        defaultPlugin: "TableX",
        // disable persistency
        persistencyExpire: 0,
        maxPersistentResponseSize: 0,
      });

      if (lang == "fr") {
        yasr.plugins["Grid"].config.lang = "fr";
        yasr.plugins["Stats"].config.lang = "fr";
      } else {
        yasr.plugins["Grid"].config.lang = "en";
        yasr.plugins["Stats"].config.lang = "en";
      }

      sparnatural.addEventListener("init", (event) => {
        // notify the specification to yasr plugins
        for (const plugin in yasr.plugins) {
          if (yasr.plugins[plugin].notifyConfiguration) {
            yasr.plugins[plugin].notifyConfiguration(
              sparnatural.sparnatural.specProvider
            );
          }
        }
        historyComponent.notifyConfiguration(
          sparnatural.sparnatural.specProvider
        );
        sparnaturalTextQuery.notifyConfiguration(
          sparnatural.sparnatural.specProvider
        );
      });

      document
        .getElementById("myCustomButton")
        .addEventListener("click", () => {
          historyComponent.openHistoryModal();
        });

      sparnatural.addEventListener("queryUpdated", (event) => {
        // get the SPARQL query string, and pass it to yasQE
        queryString = sparnatural.expandSparql(event.detail.queryString);
        lastquery = event.detail.queryJson;
        yasqe.setValue(queryString);

        // save query
        document.getElementById("query-json").value = JSON.stringify(
          event.detail.queryJson
        );

        // notify the query to yasr plugins
        for (const plugin in yasr.plugins) {
          if (yasr.plugins[plugin].notifyQuery) {
            yasr.plugins[plugin].notifyQuery(event.detail.queryJson);
          }
        }
      });

      // binds Sparnatural with the YasR plugins
      bindSparnaturalWithYasrPlugins(sparnatural, yasr);
      // binds Sparnatural with itself for the query execution and integration with yasqe and yasr
      bindSparnaturalWithItself(sparnatural, yasqe, yasr);

      document.getElementById("sparql-toggle").onclick = function () {
        if (document.getElementById("yasqe").style.display == "none") {
          document.getElementById("yasqe").style.display = "block";
          yasqe.setValue(yasqe.getValue());
          yasqe.refresh();
          document.getElementById("sparql-toggle-icon").className =
            "fad fa-eye-slash fa-fw";
        } else {
          document.getElementById("yasqe").style.display = "none";
          document.getElementById("sparql-toggle-icon").className =
            "fad fa-eye fa-fw";
        }
        return false;
      };

      document.getElementById("share").onclick = function () {
        var compressCodec = JsonUrl("lzma");
        compressCodec
          .compress(document.getElementById("query-json").value)
          .then((result) => {
            var url = window.location.pathname;
            url += "?query=" + result;
            $("#share-link").text(url);
            $("#share-link").attr("href", url);
            $("#shareModal").modal("show");
          });
      };

      document.getElementById("export").onclick = function () {
        var jsonString = JSON.stringify(
          JSON.parse(document.getElementById("query-json").value),
          null,
          2
        );
        $("#export-json").val(jsonString);
        $("#exportModal").modal("show");
      };

      document.getElementById("import").onclick = function () {
        $("#importModal").modal("show");
      };

      document.getElementById("importButton").onclick = function () {
        var json = JSON.parse($("#import-json").val());
        $("#importModal").modal("hide");
        sparnatural.loadQuery(json);
      };

      document.getElementById("select-examples").onchange = function () {
        var key = $("#select-examples option:selected").val();
        if (sampleQueries.hasOwnProperty(key)) {
          sparnatural.loadQuery(sampleQueries[key]);
        }
      };

      sparnatural.addEventListener("submit", (event) => {
        // enable loader on button
        sparnatural.disablePlayBtn();
        historyComponent.saveQuery(lastquery);
        // trigger the query from YasQE
        yasqe.query();
      });

      historyComponent.addEventListener("loadQuery", (event) => {
        const query = event.detail.query;
        sparnatural.loadQuery(query);
      });

      sparnaturalTextQuery.addEventListener("loadQuery", (event) => {
        const query = event.detail.query;
        console.log("Query to load:", query);
        sparnatural.loadQuery(query);

        function hasNotFound(node) {
          if (!node) return false;

          // check line values
          if (
            node.line?.values?.some(
              (v) =>
                v.rdfTerm?.value ===
                "https://services.sparnatural.eu/api/v1/URI_NOT_FOUND"
            )
          ) {
            return true;
          }

          // recurse on branches
          if (node.branches?.some(hasNotFound)) return true;

          // recurse on children
          if (node.children?.some(hasNotFound)) return true;

          return false;
        }

        if (!hasNotFound(query)) {
          setTimeout(() => sparnatural.dispatchEvent(new Event("submit")), 300);
        } else {
          console.log(
            "Query contains URI_NOT_FOUND — loaded but not submitted."
          );
        }
      });

      function updateContainerPadding() {
        const stickyBar = document.querySelector(".sticky-query-bar");
        if (stickyBar) {
          const height = stickyBar.offsetHeight;
          document.documentElement.style.setProperty(
            "--sticky-bar-height",
            height + "px"
          );
        }
      }

      // Update padding when page loads and when window resizes
      document.addEventListener("DOMContentLoaded", updateContainerPadding);
      window.addEventListener("resize", updateContainerPadding);

      // Also update when sticky bar content changes (e.g., when text query expands)
      const observer = new MutationObserver(updateContainerPadding);
      const stickyBar = document.querySelector(".sticky-query-bar");
      if (stickyBar) {
        observer.observe(stickyBar, {
          childList: true,
          subtree: true,
          attributes: true,
        });
      }
    </script>
  </body>
</html>
