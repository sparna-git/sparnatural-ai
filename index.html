<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title >Sparnatural Museums & Painters</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,700|Open+Sans:300,300i,400,400i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- Sparnatural-specific -->

    <!-- Vis.js for timeline -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css">

    <!-- Font Awesome -->    
    <link rel="stylesheet" href="assets/fa6/css/all.min.css" />

    <!-- YASGUI CSS -->
    <link href="https://unpkg.com/@triply/yasgui/build/yasgui.min.css" rel="stylesheet" type="text/css" />

    <!-- datepicker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@chenfengyuan/datepicker@1.0.9/dist/datepicker.min.css">

    <!-- Sparnatural CSS -->
    <link href="./sparnatural.css" rel="stylesheet" />
    <!-- Timeline CSS -->
    <link rel="stylesheet" href="assets/css/timeline.css" />

    <link href="sparnatural-history.css" rel="stylesheet" />

    <style>
      .yasqe .CodeMirror {
        font-size: 0.8em;
      }

      #sparnatural-section {
        padding-top: 110px;
        height: auto;
        overflow: visible;
      }


      #yasqe {
        display: none;
      }


      #contact {
        margin-top:40px;
        padding: 0px;
        padding-top: 20px;
      }

    </style>

   <style>
  .new-query-container-mistral {
  max-width: 900px;
  margin: 30px auto;
  font-family: sans-serif;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  padding: 10px;
}

.voice-textarea-wrapper textarea {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 8px;
  resize: vertical;
}

.btn-send button {
  padding: 10px 16px;
  background-color: rgb(2, 184, 117);
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 15px;
}

.btn-send button:hover {
  background-color: rgb(2, 184, 117, 0.8);
}

#btnVoice {
  background-color: #f0f0f0;
  border: none;
  border-radius: 6px;
  padding: 10px 14px;
  font-size: 18px;
  cursor: pointer;
  color: #333;
}

#btnVoice:hover {
  background-color: #e0e0e0;
}

#btnVoice.recording i {
  animation: pulse 1s infinite;
  color: rgb(72, 206, 152);
}

#btnVoice.loading i {
  animation: spin 1s linear infinite;
  color: #007bff;
}

@keyframes pulse {
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.2); opacity: 0.6; }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

</style>



  <!-- /Sparnatural-specific -->

</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top d-flex align-items-center">
    <div class="container d-flex justify-content-between align-items-center">

      <div id="logo">
        <h1><a href="index.html" data-i18n="page.title"></a></h1>
      </div>

      <nav id="navbar" class="navbar">
        <ul>
          <li><a class="nav-link" href="http://sparnatural.eu"><i style="font-size:25px;" class="fa-thin fa-house"></i>&nbsp;Home</a></li>
          <li class="dropdown"><a href="#"><i style="font-size:25px;" class="fa-thin fa-globe-africa"></i>&nbsp;<span>Lang.</span> <i class="bi bi-chevron-down"></i></a>
            <ul style="width:80%;">
              <li><a href="?lang=fr">fr</a></li>
              <li><a href="?lang=en">en</a></li>
            </ul>
          </li>
          <li><a class="nav-link" href="https://github.com/sparna-git/Sparnatural"><i style="font-size:25px;" class="fab fa-github"></i>&nbsp; Github</a></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->
    </div>
  </header><!-- End Header -->

    <!-- ======= Sparnatural Section ======= -->
    <section id="sparnatural-section">
      <div class="container">

        <div class="row" style="font-style: italic; font-size:0.9em;">
          <span id="intro"><span data-i18n="intro"></span></span>
        </div>

              &nbsp;

        <div class="row" style="font-style: italic; font-size:0.9em;">
          <a href="#" id="tutorial"><i id="tutorial-toggle-icon" class="fad fa-question fa-fw"></i>&nbsp; <span data-i18n="tutorial"></a>
        </div>

        <div class="new-query-container-mistral">
          <div class="voice-textarea-wrapper">
              <textarea
                id="naturalRequest"
                rows="1"
                data-i18n-placeholder="Exemple"
                placeholder="Ex : Donne-moi toutes les ≈ìuvres expos√©es en France"
              ></textarea>
            </div>
            <div class="btn-send" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px;">
              <button id="btnVoice" onclick="startVoiceToQuery()" aria-label="Micro">
                <i id="micIcon" class="fas fa-microphone"></i>
              </button>
              <button id="btnSend" onclick="sendNaturalRequest()" data-i18n="send"></button>
          </div>
        </div>

        <!-- separateur entre les deux solution avec text OR ou OU en fr-->

        <div class="row" style="margin-top: 1em; margin-bottom: 1em;">
          <div class="col-md-12 text-center">
            <span style="font-style: italic; font-size:1.5em;" data-i18n="OR"></span>
          </div>
        </div>
        <!-- This is where Sparnatural is inserted -->
        <div class="row">

          <spar-natural 
            src="./sparnatural-config.ttl"
            endpoint="https://dbpedia.org/sparql"
            lang="en"
            defaultLang="en"
            distinct="true"
            limit="1000"
            debug="true"
          ></spar-natural>

          <input type="hidden" id="query-json"></input>
        </div>
       
        <!-- -->
        <div class="row">
          
          <div class="col-md-6">
            <span style="font-style: italic; font-size:0.9em;">
              <a href="#" id="sparql-toggle"><i id="sparql-toggle-icon" class="fad fa-eye fa-fw"></i>&nbsp; <span data-i18n="actions.toggle"></span></a>
              &nbsp;|&nbsp;
              <a href="#" id="share"><i id="share-icon" class="fad fa-share-square"></i>&nbsp; <span data-i18n="actions.share"></span></a>
              &nbsp;|&nbsp;
              <a href="#" id="export"><i id="export-icon" class="fad fa-file-export"></i>&nbsp; <span data-i18n="actions.export"></span></a>
              &nbsp;|&nbsp;
              <a href="#" id="import"><i id="import-icon" class="fad fa-file-import"></i>&nbsp; <span data-i18n="actions.import"></span></a>
            </span>
          </div>
          <div class="col-md-4">
            <form>
              <div class="form-group">
                <select class="form-control" style="width:100%; appearance: auto !important;" id="select-examples">
                  <option value="none" data-i18n="example.placeholder" selected></option>
                  <option value="example.1" data-i18n="example.1.title"></option>
                  <option value="example.2" data-i18n="example.2.title"></option>
                  <option value="example.3" data-i18n="example.3.title"></option>
                </select>
              </div>
            </form>
          </div>
          <div class="col-md-2">
            <sparnatural-history lang="fr">
              <services href="https://services.sparnatural.eu/dbpedia-en/" />
            </sparnatural-history>
            <button id="myCustomButton" class="btn btn-primary" style="width:100%;"><i class="fad fa-history"></i>&nbsp; <span data-i18n="history"></span></button>
          </div>
        </div>

      </div>
    </section><!-- End Sparnatural Section -->

    <!-- ======= YASQE Section ======= -->
    <section id="yasqe-section">
      <div class="container">

        <div id="yasqe" style="display:none; " />

      </div>
    </section>
    <!-- End YASQE Section -->

    <!-- ======= YASR Section ======= -->
    <section id="yasr-section" style="margin-top:1em;">
      <div class="container">

        <div id="yasr">
          

        </div>

      </div>
    </section><!-- End YASR Section -->


    <!-- ======= Contact Section ======= -->
    <section id="contact">
      <div class="container" data-aos="fade-up">
        <div class="row">

          <div class="col-lg-2 col-md-2">
            <div class="contact-about">
              <a href="http://sparna.fr"><img src="assets/img/sparna.png" style="width:100%;" /></a>
            </div>
          </div>

          <div class="col-lg-3 col-md-4">
            <div class="social-links">
              <a href="mailto:thomas.francart@sparna.fr" ><i class="bi bi-envelope-fill"></i></a>                
                <a href="http://sparna.fr" ><i class="bi bi-building"></i></a>
                <a href="http://blog.sparna.fr"><i class="bi bi-journal-text"></i></a>                
                <a href="https://github.com/sparna-git/Sparnatural"><i class="bi bi-github"></i></a>
              </div>
          </div>

        </div>

      </div>
    </section><!-- End Contact Section -->

  <!-- Modal -->
  <div class="modal fade" id="shareModal" tabindex="-1" role="dialog" aria-labelledby="shareModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="shareModalLabel" data-i18n="share.modal.title"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" style="overflow:hidden;">
          <a id="share-link" href="#"></a>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="share.modal.close"></button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="exportModal" tabindex="-1" role="dialog" aria-labelledby="jsonModelLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="jsonModelLabel" data-i18n="export.modal.title"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" style="overflow:hidden;">
          <textarea class="form-control" rows="20" id="export-json" style="width:100%" readonly="readonly"></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="export.modal.close"></button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="importModal" tabindex="-1" role="dialog" aria-labelledby="jsonModelLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="jsonModelLabel" data-i18n="import.modal.title"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" style="overflow:hidden;">
          <textarea class="form-control" rows="20" id="import-json" style="width:100%"></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="importButton" data-i18n="import.modal.import"></button>
        </div>
      </div>
    </div>
  </div>

  </main><!-- End #main -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-chevron-up"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/demo.js"></script>
  <script src="sampleQueries.js"></script>

  <!-- Sparnatural-specific -->

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <!-- datepicker -->
    <script src="https://cdn.jsdelivr.net/npm/@chenfengyuan/datepicker@1.0.9/dist/datepicker.min.js"></script>

    <!-- YASGUI stuff -->
    <script src="https://unpkg.com/@triply/yasgui/build/yasgui.min.js"></script>

    <!-- vis.js for the timeline -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <!--  defines timeline plugin -->
    <script src='assets/js/timeline.js'></script>
    <script src='assets/js/myTable.js'></script>

    <!-- Sparnatural Javascript -->
    <script type="text/javascript" src="./sparnatural.js"></script>
    <script type="text/javascript" src="./sparnatural-yasgui-plugins.js"></script>

  <!-- /Sparnatural-specific -->

  <!-- i18n -->
  <script src="assets/vendor/jquery.i18n/jquery.i18n.js"></script>
  <script src="assets/vendor/jquery.i18n/jquery.i18n.messagestore.js"></script>
  <script src="assets/vendor/jquery.i18n/jquery.i18n.fallbacks.js"></script>
  <script src="assets/vendor/jquery.i18n/jquery.i18n.language.js"></script>
  <script src="assets/vendor/jquery.i18n/jquery.i18n.parser.js"></script>
  <script src="assets/vendor/jquery.i18n/jquery.i18n.emitter.js"></script>

  <!-- Json url (Compression) -->
  <script src="https://cdn.jsdelivr.net/gh/masotime/json-url@master/dist/browser/json-url.js"></script>

  <!-- Sheperd -->
  <script src="https://cdn.jsdelivr.net/npm/shepherd.js@8.3.1/dist/js/shepherd.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shepherd.js@8.3.1/dist/css/shepherd.css"/>
  <script src="tutorial.js"></script>

  <script src="sparnatural-bindings.js"></script>
  <script type="text/javascript" src="./sparnatural-history.js"></script>

    <script>
      $.urlParam = function(name){
        var results = new RegExp('[\\?&amp;]' + name + '=([^&amp;#]*)').exec(window.location.href);
        if(results == null) { return null; }
        return results[1] || 0;
      }
      var lang = ($.urlParam('lang') != null)?$.urlParam('lang'):'en';

      // set the locale
      $.i18n( { locale: lang } );  

      $.i18n().load( {
          'en': {
            'page.title': 'Sparnatural Museums',
            'menu.home': 'Sparnatural',
            'menu.lang': 'Lang.',
            'menu.github': 'Github',
            'endpoint.querying': 'Querying',
            'actions.toggle': 'Toggle SPARQL editor',
            'actions.share': 'Share',            
            'actions.export': 'Export query in JSON',
            'actions.import': 'Import query in JSON',
            'intro': 'Sparnatural is an intuitive SPARQL query editor that lets you navigate the knowledge graph on which it is configured to query model data by browsing the available classes, properties and field values.',
            'tutorial': 'First time here ? watch the tutorial !',
            'share.modal.title': 'Direct query link',
            'share.modal.close': 'Close',
            'export.modal.title': 'Query as JSON',
            'export.modal.close': 'Close',
            'import.modal.title': 'Query as JSON',
            'import.modal.import': 'Import',
            'example.placeholder': 'Load example query...',
            'example.1.title': 'Artworks displayed in Italian museums',
            'example.2.title': 'Museums where Van Goghs artworks are displayed',
            'example.3.title': '19th Century French women artists, movements, artworks & museums',
            'Results': 'Results',
            'send': 'Send',
            'Exemple': 'Ex: Give me all artworks displayed in France',
            'history': 'History',
            'OR': '- OR -'
          },
          'fr': {
            'page.title': 'Sparnatural : Mus√©es',
            'menu.home': 'Sparnatural',
            'menu.lang': 'Lang.',
            'menu.github': 'Github',
            'endpoint.querying': 'Service SPARQL:',
            'actions.toggle': 'Afficher/Masquer √©diteur SPARQL',
            'actions.share': 'Partager',            
            'actions.export': 'Exporter la requ√™te en JSON',
            'actions.import': 'Charger une requ√™te en JSON',
            'intro': 'Sparnatural est un √©diteur de requ√™tes SPARQL intuitif qui permet de naviguer dans le graphe de connaissances sur lequel il est configur√© pour interroger les donn√©es du mod√®le en parcourant les classes, propri√©t√©s et valeurs de champs disponibles.',
            'tutorial': 'Vous ne savez pas comment commencer ? cliquez ici pour √™tre guid√© !',
            'share.modal.title': 'Lien direct vers la requ√™te',
            'share.modal.close': 'Fermer',
            'export.modal.title': 'Requ√™te JSON',
            'export.modal.close': 'Fermer',
            'import.modal.title': 'Charger une requ√™te en JSON',
            'import.modal.import': 'Charger',
            'example.placeholder': 'Charger une requ√™te d\'exemple...',
            'example.1.title': 'Les ≈ìuvres expos√©es dans des mus√©es italiens',
            'example.2.title': 'Les mus√©es qui exposent les oeuvres de Vincent Van Gogh',
            'example.3.title': 'Les artistes fran√ßaises du XIXe, mouvements, ≈ìuvres & lieux d exposition',
            'Results': 'R√©sultats',
            'send': 'Envoyer',
            'Exemple': 'Ex : Donne-moi toutes les ≈ìuvres expos√©es en France',
            'history': 'Historique',
            'OR': '- OU -'
          }
      } );  
      $('body').i18n();

      // Appliquer les traductions aux attributs (comme placeholder)
      $("[data-i18n-placeholder]").each(function () {
        const key = $(this).data("i18n-placeholder");
        const translated = $.i18n(key);
        $(this).attr("placeholder", translated);
      });
      
      const sparnatural = document.querySelector("spar-natural");
      const historyComponent = document.querySelector("sparnatural-history");

      if(lang == "fr") { 
        console.log(true);
        sparnatural.setAttribute("lang", "fr");
        historyComponent.setAttribute("lang", "fr");
      }
      
      
      // prints the endpoint
      $('#endpoint').attr("href", sparnatural.getAttribute("endpoint"));
      $('#endpoint').html(sparnatural.getAttribute("endpoint"));

      let lastquery = null;
      // load ?query= param if present
      var UrlString = window.location.search;
      var urlParams = new URLSearchParams(UrlString);
      if (urlParams.has("query") === true) {
        var compressedJson = urlParams.get("query") ;
        var compressCodec = JsonUrl('lzma');
        compressCodec.decompress(compressedJson).then(json => {
          sparnatural.loadQuery(JSON.parse(json)) ;
        });
      }      

      const yasqe = new Yasqe(document.getElementById("yasqe"), {
        requestConfig: { 
          endpoint: $('#endpoint').text(),
          method: "GET",
          header: {}
        },
        copyEndpointOnNewTab: false  
      });

      Yasr.registerPlugin("TableX",SparnaturalYasguiPlugins.TableX);
      Yasr.registerPlugin("Grid",SparnaturalYasguiPlugins.GridPlugin);
      Yasr.registerPlugin("Stats",SparnaturalYasguiPlugins.StatsPlugin);
      Yasr.registerPlugin("Timeline",Timeline);
      Yasr.plugins.TableX.defaults.uriHrefAdapter = function(uri) {
        if(uri.startsWith("http://fr.dbpedia.org/resource/")) {
          return "http://fr.wikipedia.org/wiki/" + uri.substring("http://fr.dbpedia.org/resource/".length);
        } else {
          return uri;
        }
      };
      delete Yasr.plugins['table'];
      delete Yasr.plugins['response'];
      const yasr = new Yasr(document.getElementById("yasr"), {
        pluginOrder: ["TableX", "Grid", "Stats", "Timeline"],
        defaultPlugin: "TableX",
        // disable persistency
        persistencyExpire: 0,
        maxPersistentResponseSize: 0
      });

      if(lang == "fr") { 
        yasr.plugins["Grid"].config.lang = "fr";
        yasr.plugins["Stats"].config.lang = "fr";
      } else {
        yasr.plugins["Grid"].config.lang = "en";
        yasr.plugins["Stats"].config.lang = "en";
      }

      sparnatural.addEventListener("init", (event) => {
        // notify the specification to yasr plugins
        for (const plugin in yasr.plugins) {
          if (yasr.plugins[plugin].notifyConfiguration) {
            yasr.plugins[plugin].notifyConfiguration(
              sparnatural.sparnatural.specProvider
            );
          }
        }
         historyComponent.notifyConfiguration(sparnatural.sparnatural.specProvider);
      });
      
      document.getElementById("myCustomButton").addEventListener("click", () => {
        historyComponent.openHistoryModal();
      });


      sparnatural.addEventListener("queryUpdated", (event) => {
        // get the SPARQL query string, and pass it to yasQE
        queryString = sparnatural.expandSparql(event.detail.queryString);
        lastquery = event.detail.queryJson;
        yasqe.setValue(queryString);
        
        // save query
        document.getElementById('query-json').value = JSON.stringify(event.detail.queryJson);

        // notify the query to yasr plugins
        for (const plugin in yasr.plugins) {
          if (yasr.plugins[plugin].notifyQuery) {
            yasr.plugins[plugin].notifyQuery(event.detail.queryJson);
          }
        }
      });

      // binds Sparnatural with the YasR plugins
      bindSparnaturalWithYasrPlugins(sparnatural, yasr);
      // binds Sparnatural with itself for the query execution and integration with yasqe and yasr
      bindSparnaturalWithItself(sparnatural, yasqe, yasr);

      document.getElementById('sparql-toggle').onclick = function() {
        if(document.getElementById('yasqe').style.display == 'none') {
          document.getElementById('yasqe').style.display = 'block';
          yasqe.setValue(yasqe.getValue());
          yasqe.refresh();
          document.getElementById('sparql-toggle-icon').className = 'fad fa-eye-slash fa-fw';
        } else {
          document.getElementById('yasqe').style.display = 'none';
          document.getElementById('sparql-toggle-icon').className = 'fad fa-eye fa-fw';
        }
        return false;        
      } ;

      document.getElementById('share').onclick = function() {
        var compressCodec = JsonUrl('lzma');
        compressCodec.compress(document.getElementById('query-json').value).then(result => {
          var url = window.location.pathname;
          url += '?query='+result ;
          $('#share-link').text(url);
          $('#share-link').attr('href', url);
          $('#shareModal').modal('show');
        });
      }
        
      document.getElementById('export').onclick = function() {
          var jsonString = JSON.stringify(
              JSON.parse(document.getElementById('query-json').value),
              null,
              2
            );
          $('#export-json').val(jsonString);
          $('#exportModal').modal('show');       
      } 

      document.getElementById('import').onclick = function() {
          $('#importModal').modal('show');       
      } 

      document.getElementById('importButton').onclick = function() {
          var json = JSON.parse($('#import-json').val());
          $('#importModal').modal('hide');  
          sparnatural.loadQuery(json);    
      } 

      document.getElementById('select-examples').onchange = function() {
        var key = $('#select-examples option:selected').val();
        if(sampleQueries.hasOwnProperty(key)) {
            sparnatural.loadQuery(sampleQueries[key]) ;
        }
      }

      document.getElementById('tutorial').onclick = function() {
        sparnatural.clear();
        initTour();
      }

      sparnatural.addEventListener("submit", (event) => {
        // enable loader on button
        sparnatural.disablePlayBtn() ;
        historyComponent.saveQuery(lastquery);
        // trigger the query from YasQE
        yasqe.query();
      });

      historyComponent.addEventListener("loadQuery", (event) => {
        const query = event.detail.query;
        sparnatural.loadQuery(query);
      });

    </script>
  </script>
  <script>
        async function sendNaturalRequest() {
        const prompt = document.getElementById("naturalRequest").value.trim();
        const sendButton = document.getElementById("btnSend");;

        if (!prompt) {
          alert("‚ùå Veuillez entrer une requ√™te naturelle.");
          return;
        }

        // Sauvegarder le texte initial et mettre le loading spinner
        const originalText = sendButton.innerHTML;
        sendButton.disabled = true;
        sendButton.innerHTML = `<i class="fas fa-spinner fa-spin"></i>`;

        const url = `https://services.sparnatural.eu/dbpedia-en/api/v1/text2query?text=${encodeURIComponent(prompt)}`;
        console.log("URL de la requ√™te :", url);

        try {
          const res = await fetch(url);
          if (!res.ok) throw new Error(`Erreur HTTP ${res.status}`);
          const json = await res.json();

          const sparnaturalEl = document.querySelector("spar-natural");
          if (sparnaturalEl && typeof sparnaturalEl.loadQuery === "function") {
            sparnaturalEl.loadQuery(json);
          }
        } catch (err) {
          console.error("Erreur lors de l'envoi de la requ√™te :", err);
          alert("‚ùå Erreur lors de l'envoi de la requ√™te : " + err.message);
        } finally {
          sendButton.innerHTML = originalText || "Envoyer";
          sendButton.disabled = false;
        }
      }

      let recognition = null;
      let isRecording = false;

      function startVoiceToQuery() {
        const btn = document.getElementById("btnVoice");
        const icon = document.getElementById("micIcon");
        const textarea = document.getElementById("naturalRequest");

        if (
          !(
            "webkitSpeechRecognition" in window || "SpeechRecognition" in window
          )
        ) {
          alert(
            "üö´ La reconnaissance vocale n'est pas support√©e sur ce navigateur."
          );
          return;
        }

        if (isRecording) {
          recognition.stop();
          return;
        }

        const SpeechRecognition =
          window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        if (lang === "fr") {
          recognition.lang = "fr-FR";
        } else {
          recognition.lang = "en-US";
        }
        console.log("Langue de reconnaissance :", recognition.lang);
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        isRecording = true;
        btn.classList.add("recording");
        icon.className = "fas fa-microphone";

        recognition.start();

        recognition.onresult = async (event) => {
          const transcript = event.results[0][0].transcript;
          textarea.value = transcript;


          btn.classList.remove("recording");
          btn.classList.add("loading");

          try {
            await sendNaturalRequest();
          } catch (e) {
            alert("Erreur lors de l'envoi de la requ√™te : " + e.message);
          } finally {
            resetVoiceButtonUI();
          }
        };

        recognition.onerror = (event) => {
          alert("Erreur de reconnaissance vocale : " + event.error);
          resetVoiceButtonUI();
        };

        recognition.onend = () => {
          if (isRecording) resetVoiceButtonUI();
        };

        function resetVoiceButtonUI() {
          isRecording = false;
          btn.classList.remove("recording", "loading");
          icon.className = "fas fa-microphone";
        }
      }
    </script>


</body>

</html>